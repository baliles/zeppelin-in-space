#!/usr/bin/env bash
# bin/proxy-zeppelin
# generate nginx conf and run nginx, proxy + basic auth for zeppelin

echo "at=generate-nginx-conf"
export DAEMON=off
export RESOLVER=$(cat /etc/resolv.conf |grep -i nameserver|head -n1|cut -d ' ' -f2)
erb /app/conf/nginx.conf.erb > /app/nginx/conf/nginx.conf
erb /app/conf/htpasswd.erb > /app/nginx/conf/htpasswd
cp /app/conf/mime.types /app/nginx/conf/mime.types
cp /app/conf/set-backend.html /app/nginx/conf/set-backend.html
echo "at=start-nginx"
exec /app/nginx/bin/nginx -p /app/nginx -c /app/nginx/conf/nginx.conf